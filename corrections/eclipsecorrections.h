#include "TF1.h"
#include "TGraph.h"

int eclipsemode = 0;

vector<float> binbounds = {0,5,10,15,20,30,40,50,60,200};


int geteclbinindex(float bin)
{
  for(unsigned i=0;i<binbounds.size();i++)
    if (binbounds[i]>bin) return i-1;
  return binbounds.size()-2;
}


vector<float> binmeanmc, binmeandt;
vector<float> NSfracincmc, NSfracincdt;

vector<float> par0mc, par1mc;
vector<float> par0dt, par1dt;


TF1 *fecl;




TGraph *gpar0mc=0, *gpar1mc=0;
TGraph *gpar0dt=0, *gpar1dt=0;
TGraph *gNSfracincmc=0, *gNSfracincdt=0;

void loadeclipse()
{
   fecl = new TF1("feclipse","exp(-[0]*exp(-[1]*x))");

  if (eclipsemode==0) {
    binmeanmc = {1.85759,7.03006,11.9243,17.0175,24.0874,34.2351,44.4403,54.1906,92.2865};
    NSfracincmc = {1,1,1,1,1,1,1,1,1};//{1.2,1.2,1.2,1.2,1.4,1.4,1.4,1.4,1.6,1.6};//{1,1,1,1,1,1,1,1,1};
    par0mc = {20.7652,23.7216,39.5145,24.7379,22.205,7.21922,3.56058,2.54298,0.642064};
    par1mc = {0.0799519,0.0853334,0.102825,0.0959876,0.0985177,0.0799563,0.0746687,0.0693173,0.056642};



    //old jec ? 
    // binmeanmc = {1.83014,7.02054,11.8852,17.0213,24.1649,34.2033,44.4239,54.1938,92.1712};
    // NSfracincmc = {1,1,1,1,1,1,1,1,1};
    // par0mc = {39.9932,32.4355,41.1252,22.975,38.2263,9.0534,3.45607,1.95007,0.716772};
    // par1mc = {0.0885855,0.089385,0.103501,0.0973455,0.10664,0.0824036,0.0742716,0.0656529,0.0580254};
    
    binmeandt = {1.82676,6.8791,11.9878,16.9495,24.465,34.3395,44.3056,54.3455,86.5526};
    NSfracincdt = {1,1,1,1,1,1,1,1,1};
    par0dt = {33.0231,25.027,22.4494,14.4906,17.3466,9.30507,3.09371,0.978869,0.393019};
    par1dt = {0.0884537,0.0916158,0.0947873,0.091175,0.0936965,0.0909332,0.0786899,0.0643482,0.0550804};

  }
  if (eclipsemode==1) {

    binmeanmc = {1.85759,7.03006,11.9243,17.0175,24.0874,34.2351,44.4403,54.1906,92.2865};
    NSfracincmc = {0.936427,0.916281,0.899931,0.896401,0.863478,0.801669,0.684197,0.610484,0.389421};
    par0mc = {18.1711,19.9312,32.1561,20.4474,17.6702,5.41424,2.3534,1.46491,0.244543};
    par1mc = {0.0789364,0.0839883,0.10115,0.0946377,0.0971702,0.0789454,0.0742867,0.068507,0.0566169};

    //old jec
    // binmeanmc = {1.83014,7.02054,11.8852,17.0213,24.1649,34.2033,44.4239,54.1938,92.1712};
    // NSfracincmc = {0.95155,0.921206,0.909605,0.902999,0.896862,0.819706,0.659931,0.574676,0.482841};
    // par0mc = {35.081,26.9422,33.9066,19.5859,31.5348,6.93758,2.16604,1.04959,0.335103};
    // par1mc = {0.0873084,0.087744,0.101837,0.0964118,0.105187,0.0813808,0.0735976,0.0647159,0.0575919};
    
    binmeandt = {1.82676,6.8791,11.9878,16.9495,24.465,34.3395,44.3056,54.3455,86.5526};
    NSfracincdt = {0.953929,0.932319,0.908671,0.889512,0.89686,0.850914,0.76516,0.622489,0.389046};
    par0dt = {29.5898,22.1168,19.2195,12.1393,14.7612,7.4909,2.30205,0.586241,0.16147};
    par1dt = {0.0874725,0.090791,0.0938348,0.0901986,0.0928624,0.0900128,0.0782965,0.0636429,0.0562005};

  }
  if (eclipsemode==2) {
    binmeanmc = {1.83014,7.02054,11.8852,17.0213,24.1649,34.2033,44.4239,54.1938,92.1712};
    NSfracincmc = {1.04845,1.07879,1.09039,1.097,1.10314,1.18029,1.34007,1.42532,1.51716};
    par0mc = {45.4145,38.8973,49.1055,26.7811,45.9855,11.6104,4.98896,2.9713,1.12204};
    par1mc = {0.0898231,0.0910681,0.105007,0.0983384,0.108087,0.083725,0.0754124,0.0666132,0.0584176};

    binmeandt = {1.82676,6.8791,11.9878,16.9495,24.465,34.3395,44.3056,54.3455,86.5526};
    NSfracincdt = {1.04607,1.06768,1.09133,1.11049,1.10314,1.14909,1.23484,1.37751,1.61095};
    par0dt = {36.9319,28.4173,26.2258,17.1042,20.3553,11.2449,3.97173,1.35135,0.647808};
    par1dt = {0.0895161,0.0925859,0.0959309,0.0921781,0.0947111,0.09177,0.079296,0.0641041,0.055368};


  }
  if (eclipsemode==3) {
    binmeanmc = {1.83014,7.02054,11.8852,17.0213,24.1649,34.2033,44.4239,54.1938,92.1712};
    NSfracincmc = {0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7};
    par0mc = {18.0721,15.9602,21.6177,13.351,20.9457,5.62291,2.31539,1.3144,0.479119};
    par1mc = {0.0818099,0.0838429,0.098696,0.0943111,0.102402,0.0805474,0.0736999,0.0651855,0.0572982};


    binmeandt = {1.82676,6.8791,11.9878,16.9495,24.465,34.3395,44.3056,54.3455,86.5526};
    NSfracincdt = {0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7,0.7};
    par0dt = {16.0205,13.612,12.8519,8.78273,10.4179,5.80439,2.07874,0.645129,0.284836};
    par1dt = {0.0827475,0.0875804,0.0915125,0.0888582,0.0912506,0.0889744,0.0780994,0.0632023,0.0558225};


  }
  if (eclipsemode==4) {
    binmeanmc = {1.83014,7.02054,11.8852,17.0213,24.1649,34.2033,44.4239,54.1938,92.1712};
    NSfracincmc = {1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3};
    par0mc = {90.9637,65.7384,74.0837,36.6212,64.5962,13.4575,4.81417,2.63853,0.956353};
    par1mc = {0.0973245,0.0964959,0.108977,0.100716,0.111066,0.0845123,0.0753898,0.0661916,0.058392};

    binmeandt = {1.82676,6.8791,11.9878,16.9495,24.465,34.3395,44.3056,54.3455,86.5526};
    NSfracincdt = {1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3};
    par0dt = {69.0783,43.7725,36.6295,22.0801,27.5788,13.3352,4.21767,1.27131,0.515417};
    par1dt = {0.0960085,0.0963982,0.0985108,0.0937456,0.0970974,0.0925128,0.0794284,0.064097,0.0551593};

  }



  gpar0mc = new TGraph(binmeanmc.size(),&binmeanmc[0],&par0mc[0]);
  gpar1mc = new TGraph(binmeanmc.size(),&binmeanmc[0],&par1mc[0]);

  gpar0dt = new TGraph(binmeandt.size(),&binmeandt[0],&par0dt[0]);
  gpar1dt = new TGraph(binmeandt.size(),&binmeandt[0],&par1dt[0]);

  gNSfracincmc = new TGraph(binmeanmc.size(),&binmeanmc[0],&NSfracincmc[0]);
  gNSfracincdt = new TGraph(binmeandt.size(),&binmeandt[0],&NSfracincdt[0]);

}

float eclipseWeightmc(float jtpt2, float bin)
{
  if (gpar0mc==0)  loadeclipse();

  if (jtpt2<40) return 0;

  float par0 = gpar0mc->Eval(bin);
  float par1 = gpar1mc->Eval(bin);


  fecl->SetParameters(par0,par1);
  float p = fecl->Eval(jtpt2);

  return 1/p;
}

float eclipseWeightdt(float jtpt2, float bin)
{
  if (gpar0dt==0)  loadeclipse();
  int b = geteclbinindex(bin);

  float par0 = gpar0dt->Eval(bin);
  float par1 = gpar1dt->Eval(bin);

  fecl->SetParameters(par0,par1);
  float p = fecl->Eval(jtpt2);

  return 1/p;
}

float NSfracmc(float bin)
{
  if (gNSfracincmc==0)  loadeclipse();
  return gNSfracincmc->Eval(bin);
}

float NSfracdt(float bin)
{
  if (gNSfracincdt==0)  loadeclipse();
  return gNSfracincdt->Eval(bin);
}

